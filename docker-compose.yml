version: "3.4"
services:
  db:
    image: mysql/mysql-server
    volumes:
     - data_volume:/var/lib/mysql
    command: --max_allowed_packet=256M
    environment:
     - MYSQL_ROOT_PASSWORD=sonar
     - MYSQL_DATABASE=sonar
     - MYSQL_USER=sonar
     - MYSQL_PASSWORD=sonar
    networks:
      sonar:
        aliases:
         - sonar_db

  sonarqube:
    image: sonarqube
    ports:
     - "9000:9000"
    environment:
     - SONARQUBE_JDBC_USERNAME=sonar
     - SONARQUBE_JDBC_PASSWORD=sonar
     - SONARQUBE_JDBC_URL=jdbc:mysql://sonar_db:3306/sonar?useUnicode=true&characterEncoding=utf8&rewriteBatchedStatements=true
    networks:
     - sonar
    command: -Dsonar.ce.javaOpts=-Xmx2048m
  
volumes:
 data_volume:

networks:
 sonar:
